<main>
    <div class="outer-container">
        <div id="first-box" class="profile-form box-style"> 
            <div class="profile-details">
                <div class="profile-picture">
                    <div class="pfp-img-container img-container">
                        <img src="{{member.img_path}}" id="profile-pic" alt="Profile Picture">
                    </div>
                </div>
                <div class="profile-info">
                    <div class="profile-name">
                        <h2 id="profile-name">{{member.name}}</h2>
                    </div>
                    <div class="profile-note">
                        <div> 
                            <p class="note-desc" id="profile-note">{{member.comments}}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div> 

        <div id="personal-form" class="profile-form box-style">
            <div class="profile-information">
                <div class="title-header"><h2>PERSONAL INFORMATION</h2></div>
                
                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">UIC:</label>
                        <div class="detail-text col1" id="UIC">{{member.uic_code}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l2">Name:</label>
                        <div class="detail-text col2" id="Name">{{member.name}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l2"></label>
                        <div class="detail-text col2" id="Name"></div>
                    </div>
                </div>

                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">Birthday:</label>
                        <div class="detail-text col1" id="Birthday">{{member.birthday}}</div>
                    </div>
                    
                    <div class="details">
                        <label class="detail-label l2">Barangay:</label>
                        <div class="detail-text col2" id="Barangay">{{member.barangay}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l3">Location:</label>
                        <div class="detail-text col3" id="Location">{{member.location}}</div>
                    </div>
                </div>
    
                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">Gender:</label>
                        <div class="detail-text col1" id="Gender">{{member.gender}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l2">Sex:</label>
                        <div class="detail-text col2" id="Sex">{{member.sex}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l3">Civil Status:</label>
                        <div class="detail-text col3" id="Civil">{{member.civil_status}}</div>
                    </div>
                </div>

                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">Contact:</label>
                        <div class="detail-text col1" id="Contact">{{member.contact_number}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l2">Email:</label>
                        <div class="detail-text col2" id="Email">{{member.email}}</div>
                    </div>

                    <div class="details">
                        <label class="detail-label l1">Facebook:</label>
                        <div class="detail-text col1" id="Facebook">{{member.fb_account}}</div>
                    </div>
                    
                </div>

                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">Occupation:</label>
                        <div class="detail-text col1" id="Occupation">{{member.occupation}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l2">Designation:</label>
                        <div class="detail-text col2" id="Designation">{{member.designation}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l3">Company:</label>
                        <div class="detail-text col3" id="Company">{{member.company}}</div>
                    </div>
                </div>

                <div class="education-title"><h2>Education</h2></div>
                

                    <div class="profile-item">
                        {{#if member.entries}}
                            {{#each member.entries}}
                            <div class="details">
                                <label class="detail-label l1">Course:</label>
                                <div class="detail-text col3" id="course">{{this.course}}</div>
                            </div>   
                            <div class="details">
                                <label class="detail-label l1">Education Year:</label>
                                <div class="detail-text col3" id="educationYear">{{this.educationYear}}</div>
                            </div> 
                            <div class="details">
                                <label class="detail-label l1">School Attended:</label>
                                <div class="detail-text col3" id="School_Attended">{{this.school}}</div>
                            </div>
                            {{/each}}
                        {{/if}}
                    </div>  
            </div>
        </div>

        <div id="health-form" class="profile-form box-style">
            <div class="profile-information">
                <div class="title-header"><h2>HEALTH INFORMATION</h2></div>

                <div class="profile-item" id="Health">
                    {{#if member.medications}}
                        {{#each member.medications}}
                            <div class="details">
                                <label class="detail-label l1">Medication:</label>
                                <div class="detail-text col1" id="Medication">{{this.medication}}</div>
                            </div>
                            <div class="details">
                                <label class="detail-label l2">Start Date:</label>
                                <div class="detail-text col1" id="startDate">{{this.startDate}}</div>
                            </div>
                            <div class="details">
                                <label class="detail-label l1">Condition:</label>
                                <div class="detail-text col2" id="Condition">{{this.condition}}</div>
                            </div>
                </div>
                <div class="profile-item" id="Health">
                            <div class="details">
                                <label class="detail-label l1">Attending Physician:</label>
                                <div class="detail-text col1" id="Physician">{{this.physician}}</div>
                            </div>
                            <div class="details">
                                <label class="detail-label l2">Date of Diagnosis:</label>
                                <div class="detail-text col1" id="dod">{{this.dod}}</div>
                            </div>
                            <div class="details">
                                <label class="detail-label l1">Treatment Hub:</label>
                                <div class="detail-text col2" id="TreatmentHub">{{this.treatmentHub}}</div>
                            </div>
                </div>
                <div class="profile-item" id="Health">
                            <div class="details">
                                <label class="detail-label l1">Regimen:</label>
                                <div class="detail-text col1" id="Regimen">{{this.regimen}}</div>
                            </div>
                            <div class="details">
                                <label class="detail-label l2">Location:</label>
                                <div class="detail-text col1" id="Location">{{this.location}}</div>
                            </div>
                            <div class="details">
                                <label class="detail-label l1">Contact Person:</label>
                                <div class="detail-text col2" id="ContactPerson">{{this.contact}}</div>
                            </div>
                </div>
                        {{/each}}
                    {{/if}}
            </div>
                
        </div>
        
        <div id="contact-form" class="profile-form box-style">
            <div class="profile-information">
                <div class="title-header"><h2>CONTACT INFORMATION</h2></div>

                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">Contact Person:</label>
                        <div class="detail-text col1" id="ePerson">{{member.ePerson}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l1">Contact Number:</label>
                        <div class="detail-text col1" id="eContact">{{member.eContact}}</div>
                    </div>
                </div>
                <div class="profile-item">
                    <div class="details">
                        <label class="detail-label l1">Relationship:</label>
                        <div class="detail-text col1" id="eRelationship">{{member.eRelationship}}</div>
                    </div>
                    <div class="details">
                        <label class="detail-label l1">Contact Address:</label>
                        <div class="detail-text col1" id="eAddress">{{member.eAddress}}</div>
                    </div>
                </div>
                <div class="buttons">
                    <a id="editButton" href="/new_updateMember?uic_code={{member.uic_code}}">Update User Information</a>
                    <a id="editButton" href="#" onclick="deleteUser()">Delete User</a>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    function deleteUser() {
        const urlParams = new URLSearchParams(window.location.search);
        const uic_code = urlParams.get('uic_code');

        if (confirm('Are you sure you want to delete this user?')) {
            fetch('/delete-member', {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ uic_code })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(result => {
                console.log('Member deleted successfully:', result);
                // Redirect to member list or handle UI updates as needed
                window.location.href = '/mainpage'; // Example: Redirect to main page after deletion
            })
            .catch(error => {
                console.error('Error deleting member:', error);
                alert('Failed to delete member');
            });
        }
    }
</script>
